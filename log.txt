source /Users/yegor/Documents/STU/BP/venv/bin/activate
(base) yegor@tourist BP % source /Users/yegor/Documents/STU/BP/venv/bin/activate
(venv) (base) yegor@tourist BP % make run
DYLD_LIBRARY_PATH="/opt/homebrew/lib" TORCH_USE_LIBAV=0 TORCH_FORCE_NO_WEIGHTS_ONLY_LOAD=1 PYTHONHASHSEED=random venv/bin/python3.11 app.py
INFO:     Started server process [10317]
INFO:     Waiting for application startup.
APP: Application startup initiated at 06:18:21
2025-11-28 06:18:21,532 - INFO - Database tables created/checked.
APP: Users already exist in the database. Skipping default user creation.
INFO:     Application startup complete.
INFO:     Uvicorn running on https://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     127.0.0.1:57325 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:57325 - "GET /ui/global-styles.css HTTP/1.1" 200 OK
INFO:     127.0.0.1:57332 - "GET /ui/home/home.css HTTP/1.1" 200 OK
INFO:     127.0.0.1:57333 - "GET /ui/images/white-sign.png HTTP/1.1" 200 OK
INFO:     127.0.0.1:57334 - "GET /ui/theme-toggle.js HTTP/1.1" 200 OK
INFO:     127.0.0.1:57336 - "GET /ui/images/sign.png HTTP/1.1" 200 OK
INFO:     127.0.0.1:57335 - "GET /ui/home/home.js HTTP/1.1" 200 OK
INFO:     127.0.0.1:57335 - "GET /ui/live-speech/live.html HTTP/1.1" 200 OK
INFO:     127.0.0.1:57336 - "GET /ui/vendor/chart.min.js HTTP/1.1" 200 OK
INFO:     127.0.0.1:57332 - "GET /ui/live-speech/live-script.js HTTP/1.1" 200 OK
INFO:     127.0.0.1:57334 - "GET /ui/images/white.png HTTP/1.1" 200 OK
INFO:     127.0.0.1:57335 - "GET /ui/live-speech/live-style.css HTTP/1.1" 200 OK
APP: Received initialization request at 06:18:45: source_lang=en, target_lang=sk, tts_model_choice=piper, stt_model_size=base, vad_enabled_param=True, speaker_wav_path=None, speaker_text=None, speaker_lang=None
2025-11-28 06:18:45,751 - INFO - Backend: Session http_init_client: Initializing models at 06:18:45...
2025-11-28 06:18:45,751 - INFO - Backend: Session http_init_client: Initializing FasterWhisperSTT model 'base' at 20:31:53...
FasterWhisperSTT initialized with model_size=base, device=auto, compute_type=int8
2025-11-28 06:18:46,329 - INFO - Backend: Session http_init_client: FasterWhisperSTT model 'base' initialized at 20:31:53. Duration: 0.58s
2025-11-28 06:18:46,330 - INFO - Backend: Session http_init_client: CTranslate2 model for Helsinki-NLP/opus-mt-en-sk already exists at ct2_models/Helsinki-NLP--opus-mt-en-sk.
2025-11-28 06:18:46,330 - INFO - Backend: Session http_init_client: Initializing CTranslate2MT for en-sk at 06:18:46...
CTranslate2MT: Using specified device: cpu.
CTranslate2MT initialized with model_path=ct2_models/Helsinki-NLP--opus-mt-en-sk, device=cpu
2025-11-28 06:18:46,906 - INFO - Backend: Session http_init_client: CTranslate2MT initialized for en-sk on CPU (MPS fallback) at 06:18:46. Duration: 0.58s
2025-11-28 06:18:46,906 - INFO - Backend: Session http_init_client: Initializing PiperTTS with 'cs_CZ-jirka-medium' at 06:18:46...
PiperTTS: Attempting to load model 'cs_CZ-jirka-medium'.
PiperTTS: Expected ONNX model path: /Users/yegor/Documents/STU/BP/backend/tts/piper_models/cs_CZ-jirka-medium.onnx
PiperTTS: Expected JSON config path: /Users/yegor/Documents/STU/BP/backend/tts/piper_models/cs_CZ-jirka-medium.onnx.json
PiperTTS: os.path.exists(onnx_model_path): True
PiperTTS: os.path.exists(json_config_path): True
PiperTTS: MPS device explicitly requested and available.
PiperTTS initialized with model: cs_CZ-jirka-medium, device: mps, speaker_id: 0
2025-11-28 06:18:47,648 - INFO - Backend: Session http_init_client: PiperTTS 'cs_CZ-jirka-medium' initialized at 06:18:47. Duration: 0.74s.
2025-11-28 06:18:47,648 - INFO - Backend: Session http_init_client: Initializing WebRTC VAD with aggressiveness=3 at 06:18:47...
2025-11-28 06:18:47,648 - INFO - Backend: Session http_init_client: WebRTC VAD initialized at 06:18:47. Duration: 0.00s
2025-11-28 06:18:47,648 - INFO - Backend: Session http_init_client: All models initialized (or attempted to initialize) at 06:18:47.
APP: initialize_all_models completed at 06:18:47. Duration: 1.90s
APP: Model status check initiated at 06:18:47
APP: Broadcasting models_loading_status: fully_loaded=True at 06:18:47
APP: Initialization endpoint finished at 06:18:47. Total endpoint duration: 1.90s
INFO:     127.0.0.1:57332 - "POST /initialize?source_lang=en&target_lang=sk&tts_model_choice=piper HTTP/1.1" 200 OK
APP: Received initialization request at 06:18:47: source_lang=en, target_lang=sk, tts_model_choice=piper, stt_model_size=base, vad_enabled_param=True, speaker_wav_path=None, speaker_text=None, speaker_lang=None
2025-11-28 06:18:47,650 - INFO - Backend: Session http_init_client: Initializing models at 06:18:47...
2025-11-28 06:18:47,650 - INFO - Backend: Session http_init_client: FasterWhisperSTT model 'base' already initialized.
2025-11-28 06:18:47,650 - INFO - Backend: Session http_init_client: CTranslate2MT for en-sk already initialized.
2025-11-28 06:18:47,650 - INFO - Backend: Session http_init_client: PiperTTS model 'cs_CZ-jirka-medium' already initialized.
2025-11-28 06:18:47,650 - INFO - Backend: Session http_init_client: WebRTC VAD already initialized.
2025-11-28 06:18:47,650 - INFO - Backend: Session http_init_client: All models initialized (or attempted to initialize) at 06:18:47.
APP: initialize_all_models completed at 06:18:47. Duration: 0.00s
APP: Model status check initiated at 06:18:47
APP: Broadcasting models_loading_status: fully_loaded=True at 06:18:47
APP: Initialization endpoint finished at 06:18:47. Total endpoint duration: 0.00s
INFO:     127.0.0.1:57335 - "POST /initialize?source_lang=en&target_lang=sk&tts_model_choice=piper HTTP/1.1" 200 OK
2025-11-28 06:18:47,660 - INFO - Backend: Retrieved 3 voices for user 2
INFO:     127.0.0.1:57336 - "GET /api/voices HTTP/1.1" 200 OK
INFO:     127.0.0.1:57334 - "GET /ui/images/black.png HTTP/1.1" 200 OK
INFO:     127.0.0.1:57342 - "WebSocket /ws" [accepted]
App: WebSocket accepted from 127.0.0.1:57342
2025-11-28 06:18:47,663 - INFO - Backend: Session 127.0.0.1:57342: Initializing models at 06:18:47...
2025-11-28 06:18:47,663 - INFO - Backend: Session 127.0.0.1:57342: Initializing FasterWhisperSTT model 'base' at 20:31:55...
FasterWhisperSTT initialized with model_size=base, device=auto, compute_type=int8
2025-11-28 06:18:48,063 - INFO - Backend: Session 127.0.0.1:57342: FasterWhisperSTT model 'base' initialized at 20:31:55. Duration: 0.40s
2025-11-28 06:18:48,063 - INFO - Backend: Session 127.0.0.1:57342: CTranslate2 model for Helsinki-NLP/opus-mt-en-sk already exists at ct2_models/Helsinki-NLP--opus-mt-en-sk.
2025-11-28 06:18:48,063 - INFO - Backend: Session 127.0.0.1:57342: Initializing CTranslate2MT for en-sk at 06:18:48...
CTranslate2MT: Using specified device: cpu.
CTranslate2MT initialized with model_path=ct2_models/Helsinki-NLP--opus-mt-en-sk, device=cpu
2025-11-28 06:18:48,378 - INFO - Backend: Session 127.0.0.1:57342: CTranslate2MT initialized for en-sk on CPU (MPS fallback) at 06:18:48. Duration: 0.32s
2025-11-28 06:18:48,378 - INFO - Backend: Session 127.0.0.1:57342: Initializing PiperTTS with 'cs_CZ-jirka-medium' at 06:18:48...
PiperTTS: Attempting to load model 'cs_CZ-jirka-medium'.
PiperTTS: Expected ONNX model path: /Users/yegor/Documents/STU/BP/backend/tts/piper_models/cs_CZ-jirka-medium.onnx
PiperTTS: Expected JSON config path: /Users/yegor/Documents/STU/BP/backend/tts/piper_models/cs_CZ-jirka-medium.onnx.json
PiperTTS: os.path.exists(onnx_model_path): True
PiperTTS: os.path.exists(json_config_path): True
PiperTTS: MPS device explicitly requested and available.
PiperTTS initialized with model: cs_CZ-jirka-medium, device: mps, speaker_id: 0
2025-11-28 06:18:49,051 - INFO - Backend: Session 127.0.0.1:57342: PiperTTS 'cs_CZ-jirka-medium' initialized at 06:18:49. Duration: 0.67s.
2025-11-28 06:18:49,051 - INFO - Backend: Session 127.0.0.1:57342: Initializing WebRTC VAD with aggressiveness=3 at 06:18:49...
2025-11-28 06:18:49,051 - INFO - Backend: Session 127.0.0.1:57342: WebRTC VAD initialized at 06:18:49. Duration: 0.00s
2025-11-28 06:18:49,051 - INFO - Backend: Session 127.0.0.1:57342: All models initialized (or attempted to initialize) at 06:18:49.
App: Sending personal models_loading_status to new websocket 127.0.0.1:57342: fully_loaded=True
INFO:     connection open
2025-11-28 06:18:49,053 - INFO - Client connected from 127.0.0.1:57342
INFO:     127.0.0.1:57334 - "GET /ui/live-speech/audio-processor.js HTTP/1.1" 200 OK
2025-11-28 06:18:50,638 - INFO - Backend: Pre-VAD buffer RMS: 0.0207 (Threshold: 0.02)
2025-11-28 06:18:50,638 - INFO - Backend: Pre-VAD silence threshold met. Starting VAD processing.
2025-11-28 06:18:50,638 - INFO - Backend: Speech segment STARTED at 156717.988s
2025-11-28 06:18:53,397 - INFO - Backend: Final speech segment ENDED at 156720.746s. Duration: 2.860s
2025-11-28 06:18:53,397 - INFO - Backend: Processing speech segment (Final: True). Session Config: source_lang=en, target_lang=sk, TTS choice=piper, VAD enabled: True, Speaker: None
2025-11-28 06:18:53,399 - INFO - Processing audio with duration 00:02.860
2025-11-28 06:18:53,947 - INFO - Backend: Session 127.0.0.1:57342: STT completed. Transcribed: ' Hello, can you hear me now?' (Detected Lang: en). Time: 0.55s. Input->STT Latency: 0.88s
Translated ' Hello, can you hear me now?' (en) to 'Haló, počujete ma?' (sk) in 0.0820s
2025-11-28 06:18:54,031 - INFO - Backend: Session 127.0.0.1:57342: MT completed for en-sk. Translated: 'Haló, počujete ma?'. Time: 0.08s
2025-11-28 06:18:54,031 - INFO - Backend: Session 127.0.0.1:57342: Starting TTS synthesis...
2025-11-28 06:18:54,031 - INFO - Backend: Session 127.0.0.1:57342: Starting Piper TTS synthesis...
Piper synthesized text: 'Haló, počujete ma?' in 0.1430s (language: sk, speaker: 0)
2025-11-28 06:18:54,179 - INFO - Backend: Session 127.0.0.1:57342: TTS completed. Time: 0.14s
2025-11-28 06:18:54,179 - INFO - Backend: Sending final_metrics: {'stt_time': 0.5497030419937801, 'mt_time': 0.08337929099798203, 'tts_time': 0.1432406250096392, 'input_to_stt_latency': 0.8760548329737503, 'total_latency': 0.7763229580014013}
2025-11-28 06:18:54,182 - INFO - Backend: Pre-VAD buffer RMS: 0.0092 (Threshold: 0.02)
2025-11-28 06:18:56,141 - WARNING - Backend: Received an all-zero audio chunk. Skipping processing.
2025-11-28 06:18:56,173 - WARNING - Backend: Received an all-zero audio chunk. Skipping processing.
2025-11-28 06:18:56,413 - INFO - Backend: Pre-VAD buffer RMS: 0.1433 (Threshold: 0.02)
2025-11-28 06:18:56,413 - INFO - Backend: Pre-VAD silence threshold met. Starting VAD processing.
2025-11-28 06:18:56,414 - INFO - Backend: Speech segment STARTED at 156723.763s
2025-11-28 06:18:58,937 - INFO - Backend: Final speech segment ENDED at 156726.287s. Duration: 2.060s
2025-11-28 06:18:58,938 - INFO - Backend: Processing speech segment (Final: True). Session Config: source_lang=en, target_lang=sk, TTS choice=piper, VAD enabled: True, Speaker: None
2025-11-28 06:18:58,939 - INFO - Processing audio with duration 00:02.060
2025-11-28 06:19:00,198 - INFO - Backend: Session 127.0.0.1:57342: STT completed. Transcribed: ' you can do' (Detected Lang: en). Time: 1.26s. Input->STT Latency: 1.59s
Translated ' you can do' (en) to 'Dokážeš to.' (sk) in 0.0426s
2025-11-28 06:19:00,241 - INFO - Backend: Session 127.0.0.1:57342: MT completed for en-sk. Translated: 'Dokážeš to.'. Time: 0.04s
2025-11-28 06:19:00,241 - INFO - Backend: Session 127.0.0.1:57342: Starting TTS synthesis...
2025-11-28 06:19:00,241 - INFO - Backend: Session 127.0.0.1:57342: Starting Piper TTS synthesis...
Piper synthesized text: 'Dokážeš to.' in 0.0524s (language: sk, speaker: 0)
2025-11-28 06:19:00,297 - INFO - Backend: Session 127.0.0.1:57342: TTS completed. Time: 0.05s
2025-11-28 06:19:00,297 - INFO - Backend: Sending final_metrics: {'stt_time': 1.2602557500067633, 'mt_time': 0.04294062498956919, 'tts_time': 0.052587457990739495, 'input_to_stt_latency': 1.589330582995899, 'total_latency': 1.355783832987072}
2025-11-28 06:19:00,300 - INFO - Backend: Pre-VAD buffer RMS: 0.0123 (Threshold: 0.02)
2025-11-28 06:19:00,303 - INFO - Backend: Pre-VAD buffer RMS: 0.0135 (Threshold: 0.02)
2025-11-28 06:19:01,760 - WARNING - Backend: Received an all-zero audio chunk. Skipping processing.
2025-11-28 06:19:01,792 - WARNING - Backend: Received an all-zero audio chunk. Skipping processing.
2025-11-28 06:19:01,968 - INFO - Backend: Pre-VAD buffer RMS: 0.0116 (Threshold: 0.02)
2025-11-28 06:19:02,482 - INFO - Backend: Pre-VAD buffer RMS: 0.0208 (Threshold: 0.02)
2025-11-28 06:19:02,483 - INFO - Backend: Pre-VAD silence threshold met. Starting VAD processing.
2025-11-28 06:19:02,484 - INFO - Backend: Speech segment STARTED at 156729.833s
2025-11-28 06:19:13,943 - INFO - Backend: Final speech segment ENDED at 156741.292s. Duration: 11.620s
2025-11-28 06:19:13,943 - INFO - Backend: Processing speech segment (Final: True). Session Config: source_lang=en, target_lang=sk, TTS choice=piper, VAD enabled: True, Speaker: None
2025-11-28 06:19:13,944 - INFO - Processing audio with duration 00:11.620
2025-11-28 06:19:14,594 - INFO - Backend: Session 127.0.0.1:57342: STT completed. Transcribed: ' Hello, my name is Igor, and this is a test of HRT processing.' (Detected Lang: en). Time: 0.65s. Input->STT Latency: 0.95s
Translated ' Hello, my name is Igor, and this is a test of HRT processing.' (en) to 'Zdravím, volám sa Igor, a toto je test spracovania HSL.' (sk) in 0.1301s
2025-11-28 06:19:14,725 - INFO - Backend: Session 127.0.0.1:57342: MT completed for en-sk. Translated: 'Zdravím, volám sa Igor, a toto je test spracovania HSL.'. Time: 0.13s
2025-11-28 06:19:14,725 - INFO - Backend: Session 127.0.0.1:57342: Starting TTS synthesis...
2025-11-28 06:19:14,725 - INFO - Backend: Session 127.0.0.1:57342: Starting Piper TTS synthesis...
Piper synthesized text: 'Zdravím, volám sa Igor, a toto je test spracovania HSL.' in 0.2161s (language: sk, speaker: 0)
2025-11-28 06:19:14,954 - INFO - Backend: Session 127.0.0.1:57342: TTS completed. Time: 0.22s
2025-11-28 06:19:14,954 - INFO - Backend: Sending final_metrics: {'stt_time': 0.6514402499888092, 'mt_time': 0.13065654100500979, 'tts_time': 0.2162802090169862, 'input_to_stt_latency': 0.9547211659955792, 'total_latency': 0.9983770000108052}
2025-11-28 06:19:14,957 - INFO - Backend: Pre-VAD buffer RMS: 0.0083 (Threshold: 0.02)
2025-11-28 06:19:14,960 - INFO - Backend: Pre-VAD buffer RMS: 0.0085 (Threshold: 0.02)
2025-11-28 06:19:20,694 - WARNING - Backend: Received an all-zero audio chunk. Skipping processing.
2025-11-28 06:19:21,207 - INFO - Backend: Pre-VAD buffer RMS: 0.0204 (Threshold: 0.02)
2025-11-28 06:19:21,208 - INFO - Backend: Pre-VAD silence threshold met. Starting VAD processing.
2025-11-28 06:19:21,208 - WARNING - Backend: VAD received an all-zero audio frame.
2025-11-28 06:19:21,209 - INFO - Backend: Speech segment STARTED at 156748.558s
^CINFO:     Shutting down
2025-11-28 06:19:46,808 - ERROR - An unexpected error occurred in handle_audio_stream for 127.0.0.1:57342: Cannot call "receive" once a disconnect message has been received.
2025-11-28 06:19:46,809 - ERROR - Backend: Error sending error message to client 127.0.0.1:57342: Unexpected ASGI message 'websocket.send', after sending 'websocket.close' or response already completed.
2025-11-28 06:19:46,809 - INFO - Client 127.0.0.1:57342 handler finished. Cleaning up session.
2025-11-28 06:19:46,809 - INFO - Backend: Session 127.0.0.1:57342 removed from active_sessions. Models unloaded.
2025-11-28 06:19:46,809 - INFO - Backend: Cleanup complete for client 127.0.0.1:57342.
INFO:     connection closed
INFO:     Waiting for application shutdown.
APP: Application shutdown completed at 06:19:46
INFO:     Application shutdown complete.
INFO:     Finished server process [10317]

(venv) (base) yegor@tourist BP % 