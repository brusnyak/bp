<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="color-scheme" content="dark light" />
    <title>Live Speech Translation</title>
    <link rel="stylesheet" href="/ui/global-styles.css" />
    <link rel="stylesheet" href="/ui/live-speech/live-style.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <script src="/ui/vendor/chart.min.js"></script>
  </head>
  <body>
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <h3>Stored Voices</h3>
        <button class="close-sidebar-btn" id="closeSidebarBtn">‚úñ</button>
      </div>
      <div id="voiceLanguageSections" class="voice-language-sections-container">
        <!-- Language sections and voices will be loaded here by JavaScript -->
      </div>

      <div class="sidebar-bottom-section">
        <button id="accountButton" class="account-button">
            <img id="accountUserIcon" src="/ui/images/white.png" alt="User Icon" class="user-icon">
            <span id="accountUsername">Guest</span>
        </button>
        <div id="accountFloatingContainer" class="account-floating-container hidden">
            <div class="account-info-group">
                <p><span class="account-label">Username:</span> <span id="accountDisplayUsername">Guest</span></p>
                <p><span class="account-label">Email:</span> <span id="accountDisplayEmail">guest@example.com</span></p>
            </div>
            <hr>
            <div class="account-info-group">
                <p><span class="account-label">Voice:</span> <span id="accountDisplayVoice">N/A</span></p>
                <p><span class="account-label">Language:</span> <span id="accountDisplayLanguage">English</span></p>
                <p><span class="account-label">Theme:</span> <span id="accountDisplayTheme">Light</span></p>
            </div>
            <hr>
            <div class="account-links-group">
                <a href="/ui/extra/feedback.html">Give Feedback</a>
                <a href="/ui/extra/about.html">About</a>
            </div>
            <button class="btn btn-primary logout-button">Sign Out</button>
            <div class="bottom-links">
                <a href="/ui/extra/privacy.html">Privacy</a>
                <a href="/ui/extra/terms.html">Terms</a>
                <a href="/ui/extra/faq.html">FAQ</a>
                <a href="/ui/extra/cookies.html">Cookies</a>
            </div>
        </div>
      </div>
    </div>

    <div
      class="container"
      role="application"
      aria-label="Live Speech Translation app"
    >
      <!-- Header -->
      <div class="header">
        <button class="burger-menu-btn" id="burgerMenuBtn">‚ò∞</button>
        <a href="/" class="header-title-link">
            <div class="header-title-group">
                <h1 aria-label="Live Speech Translation">üåê Live Speech Translation</h1>
                <p>Real-time translation with voice cloning</p>
            </div>
        </a>
        <div class="theme-toggle-wrapper">
            <button id="theme-toggle" class="theme-toggle-btn" aria-label="Toggle theme">
                <span class="material-symbols-outlined"></span>
            </button>
        </div>
      </div>

      <!-- Main Control Section -->
      <div class="main-controls" aria-hidden="false">
        <div class="top-row">
          <div class="state-indicators" aria-hidden="true">
            <div class="state-item" role="status" aria-live="polite">
              <span
                id="stateListening"
                class="state-icon idle"
                title="Listening"
                aria-label="Listening status"
                >üëÇ</span
              >
              <span class="state-label">Listening</span>
            </div>
            <div class="state-item" role="status" aria-live="polite">
              <span
                id="stateTranslating"
                class="state-icon idle"
                title="Translating"
                aria-label="Translating status"
                >üí¨</span
              >
              <span class="state-label">Translating</span>
            </div>
            <div class="state-item" role="status" aria-live="polite">
              <span
                id="stateSpeaking"
                class="state-icon idle"
                title="Speaking"
                aria-label="Speaking status"
                >üì¢</span
              >
              <span class="state-label">Speaking</span>
            </div>
          </div>

          <div
            class="input-level-container"
            aria-live="polite"
            aria-atomic="true"
          >
            <span class="mic-input-level-label">Mic Input Level:</span>
            <div
              class="input-level-bar-segments"
              id="inputLevelSegments"
              aria-labelledby="micLevelLabel"
              role="progressbar"
              aria-valuenow="0"
              aria-valuemin="0"
              aria-valuemax="100"
              aria-label="Microphone input level"
            >
              <!-- Segments will be dynamically added/removed by JavaScript -->
            </div>
          </div>

          <div class="control-group">
            <label for="ttsModelSelect">TTS Model</label>
            <select id="ttsModelSelect" class="model-select">
              <option value="piper">Piper (Generic Voice)</option>
              <option value="xtts">XTTS (Custom Voice)</option>
            </select>
          </div>

          <div class="control-group hidden" id="audio-output-group">
            <label for="audioOutputSelect" class="visually-hidden">Audio Output</label>
            <select
              id="audioOutputSelect"
              class="control-select"
              title="Select audio output device"
              aria-label="Select audio output device for translation"
            >
              <option value="">Default</option>
              <!-- Audio output devices will be dynamically loaded here -->
            </select>
          </div>

          <div class="control-group hidden" id="voice-selection-group">
            <label for="speakerVoiceSelect">Speaker Voice:</label>
            <select
              id="speakerVoiceSelect"
              class="model-select"
              title="Select Speaker Voice"
              aria-label="Select speaker voice for cloning"
            >
              <!-- Speaker voices will be dynamically loaded here -->
            </select>
          </div>
        </div>

        <!-- Control Buttons -->
        <div class="control-buttons">
          <button id="recordVoiceBtn" class="btn btn-secondary">
            Record Voice
          </button>
          <button id="initBtn" class="btn btn-init" aria-live="polite">
            Initialize Pipeline
          </button>
          <button id="startStopBtn" class="btn btn-primary" disabled>
            Start
          </button>
          <div class="status-indicator" aria-hidden="true">
            <span
              id="statusIndicator"
              class="indicator off"
              aria-hidden="true"
            ></span>
            <span id="statusLabel">Ready</span>
          </div>
          <p class="hint hint-text virtual-mic-hint-centered" id="virtualMicHint">
            ‚úì Virtual device detected: BlackHole 2ch (Virtual)
          </p>
        </div>
      </div>

      <!-- Main content: Two columns -->
      <div class="content">
        <!-- Left Column: Transcription -->
        <div class="column transcription-column" aria-live="polite">
          <div class="column-header">
            <h2>üìù Transcription</h2>
            <span
              id="inputLanguageBadge"
              class="language-badge"
              aria-hidden="true"
              >EN</span
            >
            <label for="inputLanguageSelect" class="visually-hidden"
              >Input language</label
            >
            <select
              id="inputLanguageSelect"
              class="language-select"
              title="Select Input Language"
              aria-label="Select input language"
            >
              <option value="auto">Auto-detect</option>
              <option value="en" selected>English (English)</option>
              <option value="es">Spanish (Espa√±ol)</option>
              <option value="fr">French (Fran√ßais)</option>
              <option value="de">German (Deutsch)</option>
              <option value="it">Italian (Italiano)</option>
              <option value="pt">Portuguese (Portugu√™s)</option>
              <option value="pl">Polish (Polski)</option>
              <option value="tr">Turkish (T√ºrk√ße)</option>
              <option value="ru">Russian (–†—É—Å—Å–∫–∏–π)</option>
              <option value="nl">Dutch (Nederlands)</option>
              <option value="cs">Czech (ƒåe≈°tina)</option>
              <option value="ar">Arabic (ÿßŸÑÿπÿ±ÿ®Ÿäÿ©)</option>
              <option value="zh-cn">Chinese (‰∏≠Êñá)</option>
              <option value="ja">Japanese (Êó•Êú¨Ë™û)</option>
              <option value="hu">Hungarian (Magyar)</option>
              <option value="ko">Korean (ÌïúÍµ≠Ïñ¥)</ko>
              <option value="hi">Hindi (‡§π‡§ø‡§®‡•ç‡§¶‡•Ä)</hi>
              <option value="sk">Slovak (Slovenƒçina)</option>
            </select>
          </div>
          <div
            class="transcript-box"
            id="transcriptionOutput"
            tabindex="0"
            role="region"
            aria-label="Transcription output"
          >
            <p class="placeholder">Waiting for speech...</p>
          </div>
        </div>

        <!-- Divider -->
        <div class="divider" aria-hidden="true"></div>

        <!-- Right Column: Translation -->
        <div class="column translation-column" aria-live="polite">
          <div class="column-header">
            <h2>üó£Ô∏è Translation</h2>
            <span
              id="outputLanguageBadge"
              class="language-badge"
              aria-hidden="true"
              >CS</span
            >
            <label for="outputLanguageSelect" class="visually-hidden"
              >Output language</label
            >
            <select
              id="outputLanguageSelect"
              class="language-select"
              title="Select Target Language"
              aria-label="Select target language"
            >
              <option value="en">English (English)</option>
              <option value="es">Spanish (Espa√±ol)</option>
              <option value="fr">French (Fran√ßais)</option>
              <option value="de">German (Deutsch)</option>
              <option value="it">Italian (Italiano)</option>
              <option value="pt">Portuguese (Portugu√™s)</option>
              <option value="pl">Polish (Polski)</option>
              <option value="tr">Turkish (T√ºrk√ße)</option>
              <option value="ru">Russian (–†—É—Å—Å–∫–∏–π)</option>
              <option value="nl">Dutch (Nederlands)</option>
              <option value="cs" selected>Czech (ƒåe≈°tina)</option>
              <option value="ar">Arabic (ÿßŸÑÿπÿ±ÿ®Ÿäÿ©)</option>
              <option value="zh-cn">Chinese (‰∏≠Êñá)</option>
              <option value="ja">Japanese (Êó•Êú¨Ë™û)</option>
              <option value="hu">Hungarian (Magyar)</option>
              <option value="ko">Korean (ÌïúÍµ≠Ïñ¥)</ko>
              <option value="hi">Hindi (‡§π‡§ø‡§®‡•ç‡§¶‡•Ä)</hi>
              <option value="sk" selected>Slovak (Slovenƒçina)</option>
            </select>
          </div>
          <div
            class="transcript-box"
            id="translationOutput"
            tabindex="0"
            role="region"
            aria-label="Translation output"
          >
            <p class="placeholder">Translation will appear here...</p>
          </div>
        </div>
      </div>

      <!-- Latency Metrics -->
      <div class="latency-metrics" role="status" aria-live="polite">
        <h3>Latency Breakdown</h3>
        <div class="metric-group">
          <div class="metric">
            <span class="metric-label">Input to STT:</span>
            <span class="metric-value" id="inputToSttTime">0.0s</span>
          </div>
          <div class="metric">
            <span class="metric-label">STT to MT:</span>
            <span class="metric-value" id="sttToMtTime">0.0s</span>
          </div>
          <div class="metric">
            <span class="metric-label">MT to TTS:</span>
            <span class="metric-value" id="mtToTtsTime">0.0s</span>
          </div>
          <div class="metric">
            <span class="metric-label">TTS to Playback:</span>
            <span class="metric-value" id="ttsToPlaybackTime">0.0s</span>
          </div>
          <div class="metric">
            <span class="metric-label">Backend Pipeline:</span>
            <span class="metric-value" id="totalPipelineTime">0.0s</span>
          </div>
          <div class="metric total-e2e">
            <span class="metric-label">Total E2E Latency:</span>
            <span class="metric-value" id="totalE2ELatency">0.0s</span>
          </div>
        </div>
        <!-- Timeline Chart Canvas -->
        <div class="timeline-chart-container">
          <canvas id="latencyTimelineChart"></canvas>
        </div>
      </div>

      <div class="settings-status" role="status" aria-live="polite" aria-atomic="true">
        <span id="settingsStatusText" class="metric-value"></span>
      </div>
      <div
        class="log-container"
        role="log"
        aria-live="polite"
        aria-atomic="false"
      >
        <h3>Activity Log</h3>
        <div id="activityLog" class="activity-log-box" tabindex="0" aria-label="Application activity log">
          <!-- Log messages will be appended here -->
        </div>
      </div>
    </div>

    <!-- Floating Configuration Window (Modal) -->
    <div id="voiceConfigModal" class="modal">
      <div class="modal-content">
        <span class="close-button" id="closeModalBtn">&times;</span>
        <h2>Record Your Voice for Cloning</h2>
        <p>
          This feature allows you to record a short audio sample of your voice.
          This sample will be used by the XTTS model to synthesize translated
          speech in your own voice, providing a more personalized experience.
        </p>
        <p class="info-text">
          (Microphone access is requested for input level visualization. Recording starts when you click "Start Recording".)
        </p>
        <div class="modal-section">
          <label class="checkbox-container">
            <input type="checkbox" id="agreeToRecordCheckbox" />
            <span class="checkmark"></span>
            I agree to provide my voice for cloning purposes.
          </label>
        </div>
        <div class="modal-body-content">
          <div class="modal-left-content">
                        <div class="modal-section">
              <label for="modalInputLanguageSelect">Voice Language:</label>
              <select
                id="modalInputLanguageSelect"
                class="language-select"
                title="Select Voice Language"
                aria-label="Select voice language for recording"
              >
                <option value="en" selected>English (English)</option>
                <option value="es">Spanish (Espa√±ol)</option>
                <option value="fr">French (Fran√ßais)</option>
                <option value="de">German (Deutsch)</option>
                <option value="it">Italian (Italiano)</option>
                <option value="pt">Portuguese (Portugu√™s)</option>
                <option value="pl">Polish (Polski)</option>
                <option value="tr">Turkish (T√ºrk√ße)</option>
                <option value="ru">Russian (–†—É—Å—Å–∫–∏–π)</option>
                <option value="nl">Dutch (Nederlands)</option>
                <option value="cs">Czech (ƒåe≈°tina)</option>
                <option value="ar">Arabic (ÿßŸÑÿπÿ±ÿ®Ÿäÿ©)</option>
                <option value="zh-cn">Chinese (‰∏≠Êñá)</option>
                <option value="ja">Japanese (Êó•Êú¨Ë™û)</option>
                <option value="hu">Hungarian (Magyar)</hi>
                <option value="ko">Korean (ÌïúÍµ≠Ïñ¥)</ko>
                <option value="hi">Hindi (‡§π‡§ø‡§®‡•ç‡§¶‡•Ä)</hi>
                <option value="sk">Slovak (Slovenƒçina)</option>
              </select>
            </div>
            <div class="modal-section">
              <p>Please read the following statement clearly:</p>
              <p class="reading-text" id="readingText">
                "Reading this statement, I agree to provide my voice for cloning purposes.
                My voice will be used to synthesize translated speech within this application."
              </p>
              <div class="input-level-container modal-input-level" aria-live="polite" aria-atomic="true">
                <span class="Mic Input Level"></span>
                <label id="modalMicLevelLabel" class="visually-hidden">Mic Input Level:</label>
                <div
                  class="input-level-bar-segments"
                  id="modalInputLevelSegments"
                  aria-labelledby="modalMicLevelLabel"
                  role="progressbar"
                  aria-valuenow="0"
                  aria-valuemin="0"
                  aria-valuemax="100"
                  aria-label="Microphone input level for modal"
                >
                  <!-- Segments will be dynamically added/removed by JavaScript -->
                </div>
              </div>
              <span id="modalRecordingStatus" class="info-text">Ready to record.</span>
              <span id="recordingIndicator" class="recording-indicator"></span>
            </div>
            <div class="modal-section">
              <label for="speakerVoiceUploadModal">Upload Existing Voice (Optional):</label>
              <input type="file" id="speakerVoiceUploadModal" accept="audio/wav" title="Upload a WAV file for voice cloning" aria-label="Upload speaker voice WAV file" class="hidden-file-input">
              <span id="currentSpeakerVoiceModal" class="info-text">No voice selected</span>
            </div>
          </div>
          <div class="modal-right-controls">
            <button id="startRecordingModalBtn" class="btn btn-primary" disabled>
              Start Recording
            </button>
            <button id="stopRecordingModalBtn" class="btn btn-danger hidden" disabled>
              Stop Recording
            </button>
            <button id="uploadSpeakerVoiceModalBtn" class="btn btn-secondary" disabled>
              Upload Voice
            </button>
            <button id="cancelModalBtn" class="btn btn-secondary">Cancel</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Voice Naming Modal -->
    <div id="voiceNamingModal" class="modal">
      <div class="modal-content">
        <span class="close-button" id="closeNamingModalBtn">&times;</span>
        <h2>Name Your Voice Recording</h2>
        <p>Please provide a name for your recorded voice. This name will be used to identify it in the stored voices list.</p>
        <div class="modal-section">
          <label for="voiceNameInput">Voice Name:</label>
          <input type="text" id="voiceNameInput" placeholder="e.g., My Custom Voice" class="text-input">
          <span id="voiceNameError" class="info-text error-text"></span>
        </div>
        <div class="modal-buttons">
          <button id="saveVoiceNameBtn" class="btn btn-primary">Save Voice</button>
          <button id="cancelVoiceNameBtn" class="btn btn-secondary">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteConfirmationModal" class="modal">
      <div class="modal-content">
        <span class="close-button" id="closeDeleteModalBtn">&times;</span>
        <h2>Confirm Deletion</h2>
        <p id="deleteConfirmationText">Are you sure you want to delete this voice?</p>
        <div class="modal-buttons">
          <button id="confirmDeleteBtn" class="btn btn-danger">Delete</button>
          <button id="cancelDeleteBtn" class="btn btn-secondary">Cancel</button>
        </div>
      </div>
    </div>

    <script src="/ui/theme-toggle.js"></script>
    <!-- Custom Notification Bar -->
    <div id="notificationBar" class="notification-bar" role="alert" aria-live="assertive"></div>

    <script src="/ui/live-speech/live-script.js"></script>
  </body>
</html>
